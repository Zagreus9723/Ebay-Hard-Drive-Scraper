{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% block script %}
    <script>
        let photo = "{% trans 'Photo' %}";
        let itemPhoto = "{% trans 'Item Photo' %}";
        let title = "{% trans 'Title' %}";
        let price = "{% trans 'Price' %}";
        let shipping = "{% trans 'Shipping' %}";
        let size = "{% trans 'Size' %}";
        let pricePer = "{% trans 'Price Per' %}";
        let physicalSize = "{% trans 'Physical Size' %}";
        let driveInterface = "{% trans 'Drive Interface' %}";
        let condition = "{% trans 'Condition' %}";
    </script>
{% endblock %}
{% block content %}
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <!-- Dropdown -->
        <div class="dropdown">
            <button class="btn btn-light dropdown-toggle" type="button" id="localizationDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                Sites (Coming soon)
            </button>
            <ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">
                {% for loc in localizations %}
                    <li>
                        <a class="dropdown-item {% if loc.name != 'United States' %}disabled{% endif %}" href="{{ loc.href }}">
                            <img src="{{ loc.flag }}" alt="{{ loc.name }} flag" style="max-width: 20px; margin-right: 8px;">
                            {{ loc.name }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Toggle button for mobile -->
        <button class="btn btn-primary d-lg-none" id="toggle-menu">
            Filters
        </button>
    </div>
</nav>
<div class="container-fluid">
    <div class="row">
        <!-- Main Content -->
        <main class="col-lg-10 col-12">
            <table
                id="table"
                data-search="true"
                data-show-refresh="true"
                data-show-toggle="true"
                data-show-fullscreen="true"
                data-show-columns="true"
                data-show-columns-toggle-all="true"
                data-detail-view="true"
                data-show-export="false"
                data-click-to-select="true"
                data-detail-formatter="detailFormatter"
                data-minimum-count-columns="2"
                data-show-pagination-switch="true"
                data-pagination="true"
                data-id-field="title"
                data-page-list="[10, 25, 50, 100, all]"
                data-side-pagination="local"
                data-url="{% static 'json_data/United States.json' %}"
                data-response-handler="responseHandler"
                data-height="auto">
            </table>
        </main>

        <!-- Aside (Filters) -->
        <aside id="filter-menu" class="d-none col-lg-2 col-12 d-lg-flex flex-column align-items-center top-0 bg-light p-3 overflow-auto vh-100">
                    <button class="btn btn-primary d-lg-none" id="detoggle-menu">
            {% trans "Close Filters" %}
        </button>
            <h3 class="text-center mb-4">{% trans "Filters" %}</h3>

            <!-- Price Range -->
            <div class="mb-4 w-100">
                <label for="min-price" class="form-label">{% trans "Price Range" %}:</label>
                <span id="price-range">$0 - $5000</span>
                <input type="range" id="min-price" class="form-range" min="0" max="1000" step="25" value="0">
                <input type="range" id="max-price" class="form-range" min="0" max="1000" step="25" value="1000">
            </div>

            <!-- Size Range -->
            <div class="mb-4 w-100">
                <label for="min-size" class="form-label">{% trans "Size Range" %} (TB):</label>
                <span id="size-range">0 TB - 32 TB</span>
                <input type="range" id="min-size" class="form-range" min="0" max="32" step="1" value="0">
                <input type="range" id="max-size" class="form-range" min="0" max="32" step="1" value="32">
            </div>

            <!-- Condition Filters -->
            <h4 class="mb-2">{% trans "Condition" %}</h4>
            <div id="condition-filter" class="mb-4 w-100">
                <label><input type="checkbox" value="Brand New"> {% trans "Brand New" %}</label><br>
                <label><input type="checkbox" value="New (Other)"> {% trans "New (Other)" %}</label><br>
                <label><input type="checkbox" value="Open Box"> Open Box</label><br>
                <label><input type="checkbox" value="Certified - Refurbished"> {% trans "Certified Refurbished" %}</label><br>
                <label><input type="checkbox" value="Excellent - Refurbished"> {% trans "Excellent Refurbished" %}</label><br>
                <label><input type="checkbox" value="Good - Refurbished"> {% trans "Good Refurbished" %}</label><br>
                <label><input type="checkbox" value="Pre-Owned"> {% trans "Pre-Owned" %}</label><br>
                <label><input type="checkbox" value="Parts Only"> {% trans "Parts Only" %}</label>
            </div>

            <!-- Interface Filters -->
            <h4 class="mb-2">{% trans "Interface" %}</h4>
            <div id="interface-filter" class="mb-4 w-100">
                <label><input type="checkbox" value="SATA"> SATA</label><br>
                <label><input type="checkbox" value="SAS"> SAS</label><br>
                <label><input type="checkbox" value="Unknown"> {% trans "Unknown" %}</label>
            </div>

            <!-- Physical Size Filters -->
            <h4 class="mb-2">{% trans "Physical Size" %}</h4>
            <div id="physical-size-filter" class="mb-4 w-100">
                <label><input type="checkbox" value='2.5"'> 2.5"</label><br>
                <label><input type="checkbox" value='3.5"'> 3.5"</label><br>
                <label><input type="checkbox" value="Unknown"> {% trans "Unknown" %}</label>
            </div>

            <!-- Shipping Filters -->
            <h4 class="mb-2">{% trans "Shipping" %}</h4>
            <div id="shipping-filter" class="mb-4 w-100">
                <label><input type="checkbox" value="Free"> {% trans "Free shipping only" %}</label>
            </div>

            <!-- Apply Filters Button -->
            <div id="filter-apply" class="mb-4 w-100">
            <button id="apply-filters" class="btn btn-primary mt-auto">{% trans "Apply Filters" %}</button>
            </div>
                       <div id="spacing" class="mb-4 w-100"></div>
        </aside>
    </div>
</div>

<script>
    $(document).ready(() => {
        // Initialize the table
        initTable();

        // Fetch data and store it
        $.getJSON("{% static 'json_data/United States.json' %}", (data) => {
            originalData = responseHandler(data);
            $('#table').bootstrapTable('load', originalData);
        });

        // Attach event listener to filter button
        $('#apply-filters').click(applyFilters);

        // Mobile menu toggle
        $('#toggle-menu').click(() => {
            $('#filter-menu').toggleClass('active d-none');
        });
        $('#detoggle-menu').click(() => {
            $('#filter-menu').toggleClass('active d-none');
        });
        $('#apply-filters').click(() => {
            $('#filter-menu').toggleClass('active d-none');
        });
    });
</script>
<script src="{% static 'js/table.js' %}"></script>
{% endblock %}